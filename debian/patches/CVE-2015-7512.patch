From: Jason Wang
Subject: [Qemu-devel] [PATCH for 2.5 2/2] pcnet: fix rx buffer overflow(CVE-2015-7512)
Date: Mon, 30 Nov 2015 15:38:23 +0800

Backends could provide a packet whose length is greater than buffer
size. Check for this and truncate the packet to avoid rx buffer
overflow in this case.

Cc: Prasad J Pandit <address@hidden>
Cc: address@hidden
Signed-off-by: Jason Wang <address@hidden>
---
 hw/net/pcnet.c | 6 ++++++
 1 file changed, 6 insertions(+)

Index: qemu-2.0.0+dfsg/hw/net/pcnet.c
===================================================================
--- qemu-2.0.0+dfsg.orig/hw/net/pcnet.c	2015-12-01 16:01:06.620527330 -0500
+++ qemu-2.0.0+dfsg/hw/net/pcnet.c	2015-12-01 16:01:06.620527330 -0500
@@ -1087,6 +1087,12 @@
             int pktcount = 0;
 
             if (!s->looptest) {
+                if (size > 4092) {
+#ifdef PCNET_DEBUG_RMD
+                    fprintf(stderr, "pcnet: truncates rx packet.\n");
+#endif
+                    size = 4092;
+                }
                 memcpy(src, buf, size);
                 /* no need to compute the CRC */
                 src[size] = 0;
